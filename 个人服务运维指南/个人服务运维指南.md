# 概述



# 初始配置

## Ubuntu 基本配置

### 查看内核

```shell
# 查看系统内核
ubuntu@VM-4-9-ubuntu:~$ uname -r
5.4.0-77-generic

# 查看系统版本
ubuntu@VM-4-9-ubuntu:~$ cat /etc/os-release 
NAME="Ubuntu"
VERSION="20.04 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal
```

### 更换软件源

[清华源](https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/)

Ubuntu 的软件源配置文件是 ```/ect/apt/sources.list```

将系统自带的该文件做个备份，将该文件替换为下面内容，即可使用 TUNA 的软件源镜像

```shell
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
```
保存后执行以下命令，用来更新软件包：

 ```shell
 sudo apt update
 sudo apt upgrade
 ```

### 关闭防火墙

```shell
systemctl stop firewalld
```

## Docker

```shell
# 1.安装一些必要的系统工具
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common

# 2.安装GPG证书
curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -

# 3.写入软件源信息
sudo add-apt-repository "deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"

# 4.更新并安装 Docker
sudo apt-get -y update
sudo apt-get -y install docker-ce

# 5.将 Docker 的权限移交给非 root 用户，避免每次 sudo
sudo usermod -aG docker $USER

# 6.启动 Docker
sudo systemctl start docker
```

### 配置镜像加速器

编辑文件：```/etc/docker/daemon.json```，添加如下内容：

```json
{
  "registry-mirrors": [
    "https://mirror.baidubce.com"
  ]
}
```

保持后重启 Docker：

  ```shell
  sudo systemctl daemon-reload
  sudo systemctl restart docker
  ```

检查加速器是否生效，执行 ```docker info``` 命令，如果从结果中看到如下内容，说明配置成功：

```
 Registry Mirrors:
  https://mirror.baiduce.com/
```

## MySQL

```shell
# 拉取最新版本 MySQL
docker pull mysql

# 运行容器
docker run --restart=always  -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=toor -d mysql
```

测试连接

```shell
mysql -h 192.168.204.129 -u root -p
```

## Jenkins

```shell
# 安装并运行 Jenkins
docker run -u root -d --restart=always -p 18080:8080 -p 50000:50000 -v /var/jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock jenkinsci/blueocean

# 查看运行的容器
weizujie@weizujie-ubuntu:~$ docker ps
CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                                                                        NAMES
6e9a337155b9   jenkinsci/blueocean   "/sbin/tini -- /usr/…"   4 minutes ago   Up 4 minutes   0.0.0.0:50000->50000/tcp, :::50000->50000/tcp, 0.0.0.0:18080->8080/tcp, :::18080->8080/tcp   xenodochial_babbage
```

启动后，在浏览器输入：```http://192.168.204.129:18080``` 即可访问 Jenkins

首次访问提示需要输入密码，可以通过查看 Jenkins 运行日志来获取：

```shell
# docker logs [容器ID]
docker logs 6e9a337155b9
```

## Rancher 1.x

```shell
# 1.拉取最新的 Rancher 1.x
docker pull rancher/server

# 2.运行容器
docker run -p 18001:8080 -d --restart=unless-stopped rancher/server
```

启动后，在浏览器输入：```http://192.168.204.129:18001``` 即可访问 Rancher

![image-20210826093659121](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826093659121.png)

点击应用-全部，如果发现红色方框框起来的都报红，说明应用不正常，解决方法：

1. 删除 ```rm -rf /var/lib/rancher/state```目录 

2. 删除 ```rancher/agent``` 容器 

   ```shell
   docker ps
   docker kill [容器ID]
   docker rm -fv rancher-agent
   ```

3. 修改 ```/etc/docker/daemon.json``` 文件

   ```json
   {
           "dns" : [
                   "114.114.114.114",
                   "8.8.8.8"
           ]
   }

4. 重启 Docker

### 添加主机

![image-20210826094643837](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826094643837.png)

复制第 5 步的内容，执行后查看运行的容器，发现多了几个：

```shell
weizujie@weizujie-ubuntu:~$ docker ps
CONTAINER ID   IMAGE                             COMMAND                  CREATED          STATUS          PORTS                                                                                        NAMES
9958431e8e98   rancher/dns:v0.17.4               "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-network-services-metadata-dns-1-61d20283
aae1440524d8   rancher/net:v0.13.17              "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-ipsec-ipsec-connectivity-check-1-3f405924
66c92b16f102   rancher/net:v0.13.17              "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-ipsec-ipsec-router-1-f2235301
5cabfcef7f5d   rancher/healthcheck:v0.3.8        "/.r/r /rancher-entr…"   17 minutes ago   Up 17 minutes                                                                                                r-healthcheck-healthcheck-1-0becf28c
3e1677efec13   rancher/network-manager:v0.7.22   "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-network-services-network-manager-1-dd280342
e42750dd08c3   rancher/metadata:v0.10.4          "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-network-services-metadata-1-198af2a2970a6a7f258a   rancher/net:holder                "/.r/r /rancher-entr…"   17 minutes ago   Up 17 minutes                                                                                                r-ipsec-ipsec-1-cae6e55a
656fa650e964   rancher/scheduler:v0.8.6          "/.r/r /rancher-entr…"   17 minutes ago   Up 17 minutes                                                                                                r-scheduler-scheduler-1-48e66fb1
ea8cf1396cfb   rancher/net:v0.13.17              "/rancher-entrypoint…"   17 minutes ago   Up 17 minutes                                                                                                r-ipsec-cni-driver-1-35fe13b1
c1e9dfedb2ef   rancher/agent:v1.2.11             "/run.sh run"            18 minutes ago   Up 18 minutes                                                                                                rancher-agent
93328ecee2e0   rancher/server                    "/usr/bin/entry /usr…"   15 hours ago     Up 19 minutes   3306/tcp, 0.0.0.0:18001->8080/tcp, :::18001->8080/tcp                                        rancher
dc85843ac43d   mysql                             "docker-entrypoint.s…"   16 hours ago     Up 19 minutes   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp                                         mysql
6e9a337155b9   jenkinsci/blueocean               "/sbin/tini -- /usr/…"   17 hours ago     Up 19 minutes   0.0.0.0:50000->50000/tcp, :::50000->50000/tcp, 0.0.0.0:18080->8080/tcp, :::18080->8080/tcp   xenodochial_babbage
```

![image-20210826094924997](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826094924997.png)

## Nacos

使用 Rancher 可以很方便地创建一个容器，以 Nacos 为例：

![image-20210826095530202](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826095530202.png)

![image-20210826095543608](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826095543608.png)

配置好之后，在浏览器输入 ```http://192.168.204.129:8848/nacos``` 即可进入 Nacos，默认用户名和密码都是 Nacos

![image-20210826095826006](D:\学习笔记\个人服务运维指南\个人服务运维指南.assets\image-20210826095826006.png)
