# 事务

> 2022-09-06 学习

## 事务简介

**事务是一组操作的集合**，这一组操作**要么全部成功，要么全部失败**。

## 事务操作

```sql
-- 开启事务
start transaction;

-- 提交事务
commit;

-- 回滚事务
rollback;
```

## 事务四大特性（ACID）

- 原子性（Atomicity）：事务是不可分割的最小操作单元，要么全部成功，要么全部失败
- 一致性（Consistency）：事务完成时，必须使所有的数据都保持一致状态
- 隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行
- 持久性（Durability）：事务一旦提交或回滚，它对数据的改变是永久的（存放在磁盘里）

## 并发事务问题

- 脏读：一个事务**读取**到另一个事务还**未提交**的数据
- 不可重复读：一个事务先后读取同一条记录，但**两次**读取的**数据结果都不同**
- 幻读：一个事务按照条件查询数据时没有对应的数据行，然后执行插入操作，发现又存在这行数据

## 事务隔离级别

不同的事务隔离级别可以解决并发下的事务问题

| 隔离级别         | 脏读 | 不可重复读 | 幻读 |
| ---------------- | ---- | ---------- | ---- |
| 读未提交         |      |            |      |
| 读提交           | 解决 |            |      |
| 可重复读（默认） | 解决 | 解决       |      |
| 串行化           | 解决 | 解决       | 解决 |

```sql
-- 查询事务隔离级别
select @@transaction_isolation;

-- 设置事务隔离级别
set [sesstion|global] transaction isolation level {read uncommited | read commited | repeatable read | serializable}
```

# 存储引擎

> 2022-09-07 学习
>
> P59